<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AI Blog Generator – Demo</title>
    <style>
      :root {
        --bg: #0c1220;
        --surface: #121a30;
        --muted: #93a3b8;
        --text: #eaf0ff;
        --accent: #6ea8ff;
        --accent2: #62e7c8;
        --danger: #ff7373;
        --border: #222b45;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
          "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
        background: var(--bg);
        color: var(--text);
      }
      header {
        padding: 32px 20px 0;
      }
      .container {
        max-width: 980px;
        margin: 0 auto;
        padding: 20px;
      }
      .card {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 22px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.35);
      }
      h1 {
        font-size: 28px;
        margin: 0 0 10px;
      }
      p.lead {
        margin: 0;
        color: var(--muted);
      }
      form {
        display: grid;
        gap: 14px;
        margin-top: 18px;
      }
      label {
        font-weight: 600;
      }
      textarea,
      select,
      input[type="text"] {
        width: 100%;
        padding: 12px 14px;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: #0f1730;
        color: var(--text);
        outline: none;
      }
      textarea {
        min-height: 100px;
        resize: vertical;
      }
      textarea:focus,
      select:focus {
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(110, 168, 255, 0.18);
      }
      .row {
        display: grid;
        grid-template-columns: 1fr 280px;
        gap: 12px;
      }
      @media (max-width: 720px) {
        .row {
          grid-template-columns: 1fr;
        }
      }
      .actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
      }
      button {
        appearance: none;
        border: none;
        cursor: pointer;
        border-radius: 12px;
        padding: 12px 16px;
        font-weight: 700;
        transition: transform 0.08s ease, box-shadow 0.2s ease;
        color: #0b1020;
      }
      .btn-primary {
        background: linear-gradient(180deg, var(--accent), #4e7dff);
        box-shadow: 0 6px 18px rgba(89, 131, 255, 0.35);
      }
      .btn-ghost {
        background: #0f1730;
        color: var(--text);
        border: 1px solid var(--border);
      }
      .btn-danger {
        background: linear-gradient(180deg, var(--danger), #e95757);
        color: #fff;
      }
      button:active {
        transform: translateY(1px);
      }
      .hint {
        font-size: 12px;
        color: var(--muted);
      }
      .result {
        margin-top: 22px;
        display: grid;
        gap: 16px;
      }
      .result .title {
        font-size: 24px;
        font-weight: 800;
      }
      .img-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 12px;
      }
      .img-grid img {
        width: 100%;
        height: 160px;
        object-fit: cover;
        border-radius: 12px;
        border: 1px solid var(--border);
      }
      .loader {
        display: none;
        align-items: center;
        gap: 10px;
        color: var(--muted);
      }
      .dot {
        width: 8px;
        height: 8px;
        background: var(--accent2);
        border-radius: 50%;
        animation: b 0.9s infinite alternate;
      }
      .dot:nth-child(2) {
        animation-delay: 0.12s;
      }
      .dot:nth-child(3) {
        animation-delay: 0.24s;
      }
      @keyframes b {
        to {
          transform: translateY(-6px);
          opacity: 0.6;
        }
      }
      .error {
        display: none;
        padding: 12px 14px;
        border: 1px solid rgba(255, 0, 0, 0.25);
        background: rgba(255, 0, 0, 0.06);
        border-radius: 12px;
        color: #ffd4d4;
      }
      .kbd {
        padding: 4px 8px;
        border-radius: 6px;
        border: 1px solid var(--border);
        background: #0f1730;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", monospace;
        font-size: 12px;
      }
      footer {
        opacity: 0.75;
        text-align: center;
        margin: 24px 0 40px;
        font-size: 13px;
        color: var(--muted);
      }
    </style>
  </head>
  <body>
    <header class="container">
      <h1>AI Blog Generator</h1>
      <p class="lead">
        Application that talks to AI agents and supports three flows:
        <strong>blog generate</strong>, <strong>translate</strong>, and
        <strong>summarize</strong>.
      </p>
    </header>

    <main class="container card">
      <form id="blogForm">
        <div>
          <label for="topic">Topic</label>
          <textarea
            id="topic"
            name="topic"
            placeholder="e.g., The Future of Electric Vehicles"
            required
          ></textarea>
          <div class="hint">
            For <em>translate</em>, this is the content/topic to translate. For
            <em>summarize</em>, it's the thing to summarize.
          </div>
        </div>

        <div class="row">
          <div>
            <label for="action">Action</label>
            <select id="action" name="action">
              <option value="blog" selected>generate blog (default)</option>
              <option value="translate">generate blog and translate</option>
              <option value="summarize">generate blog and summarize</option>
            </select>
          </div>

          <!-- CHANGED: language input -> dropdown; id/name remain 'language' so JS stays the same -->
          <div id="languageWrapper" hidden>
            <label for="language">Language (for translate)</label>
            <select id="language" name="language">
              <option value="">— select language —</option>
              <option value="en">English</option>
              <option value="hi">Hindi</option>
              <option value="bn">Bengali</option>
              <option value="es">Spanish</option>
              <option value="ja">Japanese</option>
              <option value="fr">French</option>
              <option value="de">German</option>
            </select>
          </div>
        </div>

        <div class="actions">
          <button type="submit" class="btn-primary">Generate</button>
          <button
            type="button"
            id="clearBtn"
            class="btn-danger"
            title="Clear result"
          >
            Clear
          </button>
        </div>
        <button type="button" id="btnEV" class="btn-ghost">
          ▶ Example: EV blog
        </button>
        <button type="button" id="btnTranslate" class="btn-ghost">
          ▶ Example: Translate to Spanish
        </button>
        <button type="button" id="btnSummarize" class="btn-ghost">
          ▶ Example: Summarize
        </button>
        <div class="loader" id="loader" aria-live="polite">
          <span class="dot"></span><span class="dot"></span
          ><span class="dot"></span>
          <span>Working… contacting API</span>
        </div>
        <div class="error" id="error"></div>
      </form>

      <section class="result" id="result" hidden>
        <div class="img-grid" id="outImages"></div>
        <div class="title" id="outTitle"></div>
        <article id="outData"></article>
      </section>
    </main>

    <footer class="container">Made by Rishav with ❤️</footer>

    <script>
      const form = document.getElementById("blogForm");
      const actionEl = document.getElementById("action");
      const topicEl = document.getElementById("topic");
      const langEl = document.getElementById("language");

      const loader = document.getElementById("loader");
      const errorBox = document.getElementById("error");
      const result = document.getElementById("result");
      const outTitle = document.getElementById("outTitle");
      const outImages = document.getElementById("outImages");
      const outData = document.getElementById("outData");

      const API_URL = "https://bloggeneratoragentlg.onrender.com/blogs";

      function setLoading(isLoading) {
        loader.style.display = isLoading ? "flex" : "none";
      }
      function setError(msg) {
        if (!msg) {
          errorBox.style.display = "none";
          errorBox.textContent = "";
          return;
        }
        errorBox.textContent = msg;
        errorBox.style.display = "block";
      }
      function clearResult() {
        outTitle.textContent = "";
        outImages.innerHTML = "";
        outData.innerHTML = "";
        result.hidden = true;
        setError("");
      }

      const langWrapper = document.getElementById("languageWrapper");

      function toggleLanguage() {
        langWrapper.hidden = actionEl.value !== "translate";
      }

      actionEl.addEventListener("change", toggleLanguage);
      toggleLanguage(); // run on load

      function buildPayload() {
        const action = actionEl.value;
        const topic = topicEl.value.trim();
        const language = langEl.value.trim();
        if (!topic) throw new Error("Please enter a topic.");

        // EXACT same payload rules as before
        if (action === "translate") {
          if (!language)
            throw new Error("Please select a language (e.g., Spanish).");
          return {
            payload: { topic, language, action: "translate" },
            desc: "Translate",
          };
        }
        if (action === "summarize") {
          return { payload: { topic, action: "summarize" }, desc: "Summarize" };
        }
        // default blog
        return { payload: { topic }, desc: "Blog" };
      }

      async function callApi() {
        clearResult();
        setLoading(true);
        setError("");

        let controller = new AbortController();
        const timeout = setTimeout(() => controller.abort(), 30000); // 30s safety

        let built;
        try {
          built = buildPayload();
        } catch (e) {
          setLoading(false);
          setError(e.message);
          return;
        }

        try {
          const res = await fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(built.payload),
            mode: "cors",
            signal: controller.signal,
          });
          clearTimeout(timeout);

          if (!res.ok) {
            const text = await res.text();
            throw new Error(`HTTP ${res.status} – ${text || "Request failed"}`);
          }
          const data = await res.json();
          // expected keys: data (HTML string), title (string), images (array of URLs)
          renderResult(data);
        } catch (err) {
          if (err.name === "AbortError") {
            setError(
              "Request timed out. Is the backend running on http://localhost:8000/blogs ?"
            );
          } else if (err instanceof TypeError && /fetch/.test(String(err))) {
            setError(
              "Network/CORS error. Ensure your server allows CORS and is running at the expected URL."
            );
          } else {
            setError(err.message || "Something went wrong.");
          }
        } finally {
          setLoading(false);
        }
      }

      function renderResult(api) {
        const { title, data, images } = api || {};
        if (title) {
          outTitle.textContent = title;
        }
        if (actionEl.value === 'summarize' && Array.isArray(images)) {
          outImages.innerHTML = images
            .map((src) => `<img src="${src}" alt="image" loading="lazy" />`)
            .join("");
        }
        if (typeof data === "string") {
          outData.innerHTML = data;
        } else if (data) {
          outData.textContent = JSON.stringify(data, null, 2);
        }
        result.hidden = false;
        result.scrollIntoView({ behavior: "smooth", block: "start" });
      }

      // Events (unchanged)
      form.addEventListener("submit", (e) => {
        e.preventDefault();
        callApi();
      });
      document.addEventListener("keydown", (e) => {
        if ((e.metaKey || e.ctrlKey) && e.key.toLowerCase() === "enter") {
          e.preventDefault();
          callApi();
        }
      });

      // Example buttons (unchanged; select will accept .value assignment)
      document.getElementById("btnEV").addEventListener("click", () => {
        actionEl.value = "blog";
        langEl.value = "";
        topicEl.value = "The Future of Electric Vehicles";
        callApi();
      });
      document.getElementById("btnTranslate").addEventListener("click", () => {
        actionEl.value = "translate";
        langEl.value = "es";
        topicEl.value = "AI safety and alignment";
        callApi();
      });
      document.getElementById("btnSummarize").addEventListener("click", () => {
        actionEl.value = "summarize";
        langEl.value = "";
        topicEl.value = "Serverless architectures for startups";
        callApi();
      });
      document
        .getElementById("clearBtn")
        .addEventListener("click", clearResult);
    </script>
  </body>
</html>
